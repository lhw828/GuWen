<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>殆知阁古文全集</title>
    <style>
        /* 全局样式 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background-color: #f9f9f9;
            color: #333;
        }

        /* 导航栏样式 */
        nav {
            display: flex;
            justify-content: center;
            background-color: #4CAF50;
            padding: 10px 0;
        }

        nav a {
            text-decoration: none;
            color: white;
            font-size: 18px;
            margin: 0 15px;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        nav a:hover {
            background-color: #45a049;
        }

        /* 随机页面区域 */
        .random-section {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .random-section h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #4CAF50;
        }

        .random-links {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .random-links li {
            background-color: #f1f1f1;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .random-links a {
            text-decoration: none;
            color: #333;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        .random-links a:hover {
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav>
        <a href="佛藏/index.html">📁 佛藏</a>
        <a href="儒藏/index.html">📁 儒藏</a>
        <a href="医藏/index.html">📁 医藏</a>
        <a href="史藏/index.html">📁 史藏</a>
        <a href="子藏/index.html">📁 子藏</a>
        <a href="易藏/index.html">📁 易藏</a>
        <a href="艺藏/index.html">📁 艺藏</a>
        <a href="诗藏/index.html">📁 诗藏</a>
        <a href="道藏/index.html">📁 道藏</a>
        <a href="集藏/index.html">📁 集藏</a>
    </nav>

    <!-- 随机页面区域 -->
    <section class="random-section">
        <h2>💡 50 个随机页面</h2>
        <ul id="random-links" class="random-links"></ul>
    </section>

    <script>
        // 获取 random_pages/files.json 中的文件列表
        async function fetchRandomPagesFiles() {
            try {
                const response = await fetch('random_pages/files.json');
                if (!response.ok) throw new Error(`HTTP 错误! 状态码: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('无法加载文件列表:', error);
                throw error;
            }
        }

        // 从指定的 JSON 文件中加载数据
        async function fetchRandomPagesData(filename) {
            try {
                const response = await fetch(`random_pages/${filename}`);
                if (!response.ok) throw new Error(`HTTP 错误! 状态码: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error(`无法加载数据文件: ${filename}`, error);
                throw error;
            }
        }

        // 从页面列表中随机选择 50 个链接
        function getRandomLinks(pages, count = 49) {
            if (!pages || pages.length === 0) throw new Error('没有找到任何链接');
            const shuffled = [...pages].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        // 主逻辑
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // 获取文件列表
                const files = await fetchRandomPagesFiles();
                
                // 随机选择一个数据文件
                const jsonFiles = files.filter(file => file.endsWith('.json'));
                if (jsonFiles.length === 0) throw new Error('没有找到数据文件');
                const randomFile = jsonFiles[Math.floor(Math.random() * jsonFiles.length)];
                
                // 加载数据并显示链接
                const pages = await fetchRandomPagesData(randomFile);
                const randomLinks = getRandomLinks(pages);
                
                const container = document.getElementById('random-links');
                randomLinks.forEach(page => {
                    const li = document.createElement('li');
                    li.innerHTML = `<a href="${page.url}" target="_blank">${page.name}</a>`;
                    container.appendChild(li);
                });

            } catch (error) {
                console.error('初始化失败:', error);
                const container = document.getElementById('random-links');
                container.innerHTML = `<li style="grid-column: 1 / -1; color: red; padding: 20px;">
                    错误: ${error.message}，请检查控制台获取详细信息
                </li>`;
            }
        });
    </script>
</body>
</html>